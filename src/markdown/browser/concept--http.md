## Http

### 版本

> [HTTP各版本特性及区别](https://juejin.cn/post/6844903923136856078)

HTTP 协议从开始立项到现在一共经历了 4 个版本：

**HTTP 0.9** 

- 只支持`GET`请求方式：由于不支持其他请求方式，因此客户端是没办法向服务端传输太多的信息
- 没有请求头概念：所以不能在请求中指定版本号，服务端也只具有返回 HTML字符串的能力
- 服务端相响应之后，立即关闭TCP连接

--------

**HTTP 1.0** 

- 请求方式新增了POST，DELETE，PUT，HEADER等方式

- 增添了请求头和响应头的概念，在通信中指定了 HTTP 协议版本号，以及其他的一些元信息 (比如: 状态码、权限、缓存、内容编码)

- 扩充了传输内容格式，图片、音视频资源、二进制等都可以进行传输

> 在这个版本主要的就是对请求和响应的元信息进行了扩展，客户端和服务端有更多的获取当前请求的所有信息，进而更好更快的处理请求相关内容

-------

**HTTP 1.1**

- 长连接：新增Connection字段，可以设置keep-alive值保持连接不断开

- 管道化：基于上面长连接的基础，管道化可以不等第一个请求响应继续发送后面的请求，但响应的顺序还是按照请求的顺序返回

  ```markdown
  非管道化的长连接请求：
  	请求1 > 响应1 --> 请求2 > 响应2 --> 请求3 > 响应3
  管道化的长连接请求：
  	请求1 --> 请求2 --> 请求3 > 响应1 --> 响应2 --> 响应3
  	即使服务器先准备好响应2,也是按照请求顺序先返回响应1，虽然管道化，可以一次发送多个请求，但是响应仍是顺序返回，仍然无法解决队头阻塞的问题
  ```

- 缓存处理：新增字段cache-control

- 断点传输

  > 在上传/下载资源时，如果资源过大，将其分割为多个部分，分别上传/下载，如果遇到网络故障，可以从已经上传/下载好的地方继续请求，不用从头开始，提高效率

----

**HTTP 2.0**

- 二进制分帧

  > HTTP 1.x 的解析是基于文本，HTTP 2 之后将所有传输的信息分割为更小的消息和帧，并对它们采用二进制格式的编码，提高传输效率

- 多路复用： 在共享TCP链接的基础上同时发送请求和响应

  > 在共享TCP链接的基础上同时发送请求和响应，基于二进制分帧，在同一域名下所有访问都是从同一个tcp连接中走，http消息被分解为独立的帧，乱序发送，服务端根据标识符和首部将消息重新组装起来

- 头部压缩

  > 由于 HTTP 是无状态的，每一个请求都需要头部信息标识这次请求相关信息，所以会造成传输很多重复的信息，当请求数量增大的时候，消耗的资源就会慢慢积累上去。所以 HTTP 2 可以维护一个头部信息字典，差量进行更新头信息，减少头部信息传输占用的资源

- 服务器推送：服务器可以额外的向客户端推送资源，而无需客户端明确的请求



-----

### Https

**基本概念**

- HTTP：

  是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议,它可以使浏览器更加高效，使网络传输减少

- HTTPS：
  HTTPS 是在 HTTP 和 TCP 之间建立了一个安全层，HTTP 与 TCP 通信的时候，必须先进过一个安全层，对数据包进行加密，然后将加密后的数据包传送给 TCP，相应的 TCP 必须将数据包解密，才能传给上面的 HTTP

  > HTTPS协议的主要作用可以分为两种：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性

------

**区别**

- HTTPS 协议需要到 ca 申请证书，一般免费证书较少，因而需要一定费用
- HTTP 协议运行在 TCP 之上，所有传输的内容都是明文，HTTPS 运行在 SSL/TLS 之上，SSL/TLS 运行在 TCP 之上，所有传输的内容都经过加密的
- HTTP 和 HTTPS 使用的是完全不同的连接方式，用的端口也不一样，前者是 80，后者是 443
- HTTP 的连接很简单，是无状态的；HTTPS 协议是由 SSL + HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全

-----

**特点**

**HTTP和HTTPS的主要特点**

http：

- 支持客户/服务器模式（C/S模式）

- 简单快速：客户向服务器请求服务时，只需传送请求方法和路径，如GET，POST 等，每种方法规定了客户与服务器联系的类型不同，由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快

- 灵活：允许传输任意类型的数据对象，正在传输的类型由Content-Type加以标记

- 无连接：限制每次连接只处理一个请求，服务器处理完客户的请求，并收到客户的应答后，即断开连接，浏览器每次请求都需要建立 tcp 连接，采用这种方式可以节省传输时间，缺点是每次请求都需要建立一次 TCP 连接，网络效率低，以及请求响应到达之后下一个请求才能发送，如果前一个阻塞，后面的请求也会阻塞

  > 从HTTP/1.1起，浏览器默认都开启了 Keep-Alive，保持连接特性，客户端和服务器都能选择随时关闭连接，则请求头中为 `connection:close`，Keep-Alive 不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间

- 无状态：对于事务处理没有记忆能力，不跟踪不记录请求过的状态，缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大，另一方面，在服务器不需要先前信息时它的应答就较快

  > 无状态协议是指 http 协议本身对于事务处理没有记忆功能，服务器不知道浏览器的状态，即使用户登录了，去访问同一个网站的不同网页，服务器都不会知道用户是谁，如果需要记录登录用户的信息，用户操作，用户行为等数据需要使用 cookie 或 session 来存储

https：

- HTTPS 是 HTTP 协议的修改，它加密数据并确保其机密性，其配置可保护用户在与网站交互时免于窃取个人信息和计费数据
- 优点：
  - 相比于 http，https 可以提供更加优质保密的信息，保证了用户数据的安全性，此外 https 同时也一定程度上保护了服务端，使用恶意攻击和伪装数据的成本大大提高
- 缺点：
  - Https 的技术门槛较高，多数个人或者私人网站难以支撑，CA 机构颁发的证书都是需要年费的，此外对接 Https协议也需要额外的技术支持
  - 目前来说大多数网站并不关心数据的安全性和保密性，其 Https 最大的优点对它来说并不适用
  - Https 加重了服务端的负担，相比于http其需要更多的资源来支撑，同时也降低了用户的访问速度
  - 目前来说 Http 网站仍然大规模使用，在浏览器侧也没有特别大的差别，很多用户不关心的话根本不感知

------

**工作流程**

http：

1. 建立TCP/IP连接，客户端与服务器通过Socket三次握手进行连接
2. 客户端向服务端发起HTTP请求（例如：POST/login.html http/1.1）
3. 客户端发送请求头信息，请求内容，最后会发送一空白行，标示客户端请求完毕
4. 服务器做出应答，表示对于客户端请求的应答，例如：HTTP/1.1 200 OK
5. 服务器向客户端发送应答头信息
6. 服务器向客户端发送请求头信息后，也会发送一空白行，标示应答头信息发送完毕，接着就以Content-type要求的数据格式发送数据给客户端
7. 服务端关闭TCP连接，如果服务器或者客户端增Connection:keep-alive就表示客户端与服务器端继续保存连接，在下次请求时可以继续使用这次的连接

https：

1. 客户使用 https 的 URL 访问 Web 服务器，要求与 Web 服务器建立 SSL 连接
2. Web 服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端
3. 客户端的浏览器与 Web 服务器开始协商SSL连接的安全等级，也就是信息加密的等级
4. 客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站
5. Web 服务器利用自己的私钥解密出会话密钥
6. Web 服务器利用会话密钥加密与客户端之间的通信

