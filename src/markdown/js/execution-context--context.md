### 上下文

当函数运行的时候，会生成一个叫做 `执行上下文` 的东西，也可以叫做 `执行环境`，用于保存函数运行时需要的一些信息

- 执行上下文内部存储了包括：**变量对象**、**作用域链**、**this 指向** 这些函数运行时的必须数据

- 一个函数能够访问到的上层作用域，在函数创建的时候就已经被确定且保存在函数的 `[[scope]]` 属性里，和函数拿到哪里去执行没有关系
- 所有的执行上下文都会被交给系统的 `执行上下文栈` 来管理，它是一个栈结构数据，全局上下文永远在该栈的最底部，每当一个函数执行生成了新的上下文，该上下文对象就会被压入栈，但是上下文栈有容量限制，如果超出容量就会栈溢出



----

#### 类型

js 中有三种上下文类型

- **全局执行上下文**

  这是默认或者说是最基础的执行上下文，一个程序中只会存在一个全局上下文，它在整个`javascript` 脚本的生命周期内都会存在于执行堆栈的最底部不会被栈弹出销毁。全局上下文会生成一个全局对象（以浏览器环境为例，这个全局对象是 `window`），并且将 `this` 值绑定到这个全局对象上

- **函数执行上下文**

  每当一个函数被调用时，都会创建一个新的函数执行上下文（不管这个函数是不是被重复调用的）

- **Eval 函数执行上下文**

  执行在 `eval` 函数内部的代码也会有它属于自己的执行上下文，eval是一个用于转义字符传为可执行代码语句的函数，js里用的不多



-----

#### 内容

可以将它理解为一个 `object` ，包括以下内容

- **变量对象**

- **活动对象**

- **作用域链**

- **调用者信息**



------

#### 生命周期

**创建阶段**

发生在函数调用时且在执行函数体内的具体代码之前

- 用当前函数的参数列表（`arguments`）初始化一个 “变量对象” 并将当前执行上下文与之关联 ，函数代码块中声明的 变量和函数将作为属性添加到这个变量对象上。在这一阶段，会进行（变量/函数提升）变量和函数的初始化声明，变量统一定义为 `undefined` 需要等到赋值时才会有确值，而函数则会直接定义
- 构建作用域链
- 确定 `this` 指向

**执行阶段**

执行阶段中，JS 代码开始逐条执行，在这个阶段，JS 引擎开始对定义的变量赋值、开始顺着作用域链访问变量、如果内部有函数调用就创建一个新的执行上下文压入上下文执行栈，并定位到下一层执行栈开始执行

**销毁阶段**

函数执行完成后，当前执行上下文（局部环境）会被弹出执行上下文栈并且销毁，往上层搜索执行上下文栈并定位执行